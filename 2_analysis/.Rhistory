library(fixest)
library(rddensity)
library(ggpubr)
setwd(this.dir())
dataDir <- "../1_data/"
figureDir <- "../3_figures/"
fullSample <- readRDS(paste0(dataDir,"fullSampleT.rds"))
fullSample <- fullSample %>% filter(year<=2022)
sample7cutoffs <- fullSample %>% filter(cutoffId %in% 1:7)
sample7cutoffs <- sample7cutoffs %>% mutate(marginAbs = abs(margin))
sample7cutoffs <- sample7cutoffs %>% mutate(bw4 = if_else(marginAbs < 0.04*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw8 = if_else(marginAbs < 0.08*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw2 = if_else(marginAbs < 0.02*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpmlaw = log(fpmLaw))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpm = log(transfer_value))
sample7cutoffs <- sample7cutoffs %>% mutate(prop = temporaries/total_employees)
sample7cutoffs <- sample7cutoffs %>% mutate(lemp = log(temporaries+1))
sample7cutoffs <- sample7cutoffs %>% mutate(margin_relative = margin/closest_cutoff)
sample7cutoffs <- sample7cutoffs %>% mutate(treated = if_else(
transfer_value>=fpmLaw, 1 , 0
))
# Methdology
# First, we need to run the regressions of our depedent variables on the FEs, then we use the residuals to do the RD Plots.
regLawFpm <- feols(lfpmlaw ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
regActualFpm <- feols(lfpm ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
pLawFpm <- rdplot(regLawFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Law Implied FPM (Log)", title = "Law Implied FPM")
pActualFpm <- rdplot(regActualFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Actual FPM (Log)", title = "Actual FPM")
finalFPM <- ggarrange(pLawFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), pActualFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFPM, file=paste0(figureDir, "FPMRdPlot.png"), width=12, height=4)
# Regressions - Methdology
fpmRegBw2 = feols(lfpm ~ lfpmlaw + marginAbs + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw2==1))
fpmRegBw4 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw4==1))
fpmRegBw8 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2 | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw8==1))
# Other Revenues and Local Taxes
sample7cutoffs <- sample7cutoffs %>% mutate(other_revenue = total_revenue - transfer_value)
sample7cutoffsTax <- sample7cutoffs %>% filter(!is.na(other_revenue) & !is.na(local_taxes) & other_revenue>0)
regOtherRev <- feols(log(other_revenue+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
regLocalTaxes <- feols(log(local_taxes+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
pOtherRevenue <- rdplot(regOtherRev$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Other Revenues (Log)", title = "Other Revenues")
pLocalTaxes <- rdplot(regLocalTaxes$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Local Taxes (Log)", title = "Local Taxes")
finalFinances<- ggarrange(pOtherRevenue$rdplot + theme(plot.title = element_text(hjust = 0.5)), pLocalTaxes$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFinances, file=paste0(figureDir, "FinancesRdPlot.png"), width=12, height=4)
# Density Plots
sample2019 <- sample7cutoffs %>% filter(year == 2019)
d2019 <- rddenrddensity(sample2019$margin)
gc()
library(tidyverse)
library(this.path)
library(rdrobust)
library(fixest)
library(rddensity)
library(ggpubr)
setwd(this.dir())
dataDir <- "../1_data/"
figureDir <- "../3_figures/"
fullSample <- readRDS(paste0(dataDir,"fullSampleT.rds"))
fullSample <- fullSample %>% filter(year<=2022)
sample7cutoffs <- fullSample %>% filter(cutoffId %in% 1:7)
sample7cutoffs <- sample7cutoffs %>% mutate(marginAbs = abs(margin))
sample7cutoffs <- sample7cutoffs %>% mutate(bw4 = if_else(marginAbs < 0.04*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw8 = if_else(marginAbs < 0.08*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw2 = if_else(marginAbs < 0.02*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpmlaw = log(fpmLaw))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpm = log(transfer_value))
sample7cutoffs <- sample7cutoffs %>% mutate(prop = temporaries/total_employees)
sample7cutoffs <- sample7cutoffs %>% mutate(lemp = log(temporaries+1))
sample7cutoffs <- sample7cutoffs %>% mutate(margin_relative = margin/closest_cutoff)
sample7cutoffs <- sample7cutoffs %>% mutate(treated = if_else(
transfer_value>=fpmLaw, 1 , 0
))
# Methdology
# First, we need to run the regressions of our depedent variables on the FEs, then we use the residuals to do the RD Plots.
regLawFpm <- feols(lfpmlaw ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
regActualFpm <- feols(lfpm ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
pLawFpm <- rdplot(regLawFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Law Implied FPM (Log)", title = "Law Implied FPM")
pActualFpm <- rdplot(regActualFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Actual FPM (Log)", title = "Actual FPM")
finalFPM <- ggarrange(pLawFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), pActualFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFPM, file=paste0(figureDir, "FPMRdPlot.png"), width=12, height=4)
# Regressions - Methdology
fpmRegBw2 = feols(lfpm ~ lfpmlaw + marginAbs + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw2==1))
fpmRegBw4 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw4==1))
fpmRegBw8 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2 | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw8==1))
# Other Revenues and Local Taxes
sample7cutoffs <- sample7cutoffs %>% mutate(other_revenue = total_revenue - transfer_value)
sample7cutoffsTax <- sample7cutoffs %>% filter(!is.na(other_revenue) & !is.na(local_taxes) & other_revenue>0)
regOtherRev <- feols(log(other_revenue+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
regLocalTaxes <- feols(log(local_taxes+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
pOtherRevenue <- rdplot(regOtherRev$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Other Revenues (Log)", title = "Other Revenues")
pLocalTaxes <- rdplot(regLocalTaxes$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Local Taxes (Log)", title = "Local Taxes")
finalFinances<- ggarrange(pOtherRevenue$rdplot + theme(plot.title = element_text(hjust = 0.5)), pLocalTaxes$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFinances, file=paste0(figureDir, "FinancesRdPlot.png"), width=12, height=4)
# Density Plots
sample2019 <- sample7cutoffs %>% filter(year == 2019)
d2019 <- rddensity(sample2019$margin)
dp2019 <- rdplotdensity(d2019, sample2019$margin)
sample2009 <- sample7cutoffs %>% filter(year == 2009)
d2009 <- rddensity(sample2009$margin)
dp2009 <- rdplotdensity(d2009, sample2009$margin)
sample2005 <- sample7cutoffs %>% filter(year == 2005)
d2005 <- rddensity(sample2005$margin)
dp2005 <- rdplotdensity(d2005, sample2005$margin)
sample1999 <- sample7cutoffs %>% filter(year == 1999)
d1999 <- rddensity(sample1999$margin)
dp1999 <- rdplotdensity(d1999, sample1999$margin)
finalDensity <- ggarrange(dp1999$Estplot + ggtitle("1999") + theme(plot.title = element_text(hjust = 0.5)),
dp2005$Estplot + ggtitle("2005") + theme(plot.title = element_text(hjust = 0.5)),
dp2009$Estplot + ggtitle("2009") + theme(plot.title = element_text(hjust = 0.5)),
dp2019$Estplot + ggtitle("2019") + theme(plot.title = element_text(hjust = 0.5)),
ncol = 2, nrow = 2)
ggsave(finalDensity, file=paste0(figureDir, "DensityPlots.png"), width=9, height=4)
## IV Regressions - Section 5.1
# Quantity of Emp.
temporaryIVRegBw2 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw2==1))
temporaryIVRegBw4 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw4==1))
temporaryIVRegBw8 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw8==1))
sample7cutoffsTemp <- sample7cutoffs %>% filter(!is.na(lemp))
regLogTemps <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTemp)
optimalTempBw <- rdbwselect(regLogTemps$residuals, sample7cutoffsTemp$margin_relative, p=2, fuzzy = sample7cutoffsTemp$treated, cluster = sample7cutoffsTemp$microrregion_id)
temporaryIVRegOptimal = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(marginAbs < optimalTempBw$bws[1]*closest_cutoff))
# Proportion
propIVRegBw2 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw2==1))
propIVRegBw4 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw4==1))
propIVRegBw8 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw8==1))
sample7cutoffsProp <- sample7cutoffs %>% filter(!is.na(prop))
regLogProp <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsProp)
optimalPropBw <- rdbwselect(regLogProp$residuals, sample7cutoffsProp$margin_relative, p=2, fuzzy = sample7cutoffsProp$treated, cluster = sample7cutoffsProp$microrregion_id)
propIVRegOptimal = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(marginAbs < optimalPropBw$bws[1]*closest_cutoff))
pLogTemps <- rdplot(regLogTemps$residuals, sample7cutoffsTemp$margin, p=2, x.label="Normalized Population", y.label = "Quantity of Temporary/Comissioned Employees (Log)", title="Temporary/Comissioned Employees")
pPropTemps <- rdplot(regLogProp$residuals, sample7cutoffsProp$margin, p=2, x.label="Normalized Population", y.label = "Proportion of Temporary/Comissioned Employees (%)", title="Proportion of Temporary/Comissioned Employees")
pTempsRd <- ggarrange(pLogTemps$rdplot + theme(plot.title = element_text(hjust = 0.5)), pPropTemps$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(pTempsRd, file=paste0(figureDir, "ProportionQuantityRd.png"), width=12, height=4)
# Wages
sample7cutoffsWages <- sample7cutoffs %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
sample7cutoffsWages <- sample7cutoffsWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
wageIVRegBw2 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw2==1))
wageIVRegBw4 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw4==1))
wageIVRegBw8 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw8==1))
regLogWages <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsWages)
optimalWagesBw <- rdbwselect(regLogWages$residuals, sample7cutoffsWages$margin_relative, p=2, fuzzy = sample7cutoffsWages$treated, cluster = sample7cutoffsWages$microrregion_id)
wagesIVRegOptimal = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(marginAbs < optimalWagesBw$bws[1]*closest_cutoff))
pWages <- rdplot(regLogWages$residuals, sample7cutoffsWages$margin, p=2, x.label="Normalized Population", y.label = "Avg Wage per Temporary/Commissioned Employee (Log)", title="")
ggsave(pWages$rdplot + theme(plot.title = element_text(hjust = 0.5)), file=paste0(figureDir, "WagesRD.png"), width=6, height=4)
# Education
sample7cutoffsEduc <- sample7cutoffs %>% filter(temporaries>0 & !is.na(temporaries))
sample7cutoffsEduc <- sample7cutoffsEduc %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
sample7cutoffsEduc <- sample7cutoffsEduc %>% mutate(educPropUni = (temporaries_university/temporaries)*100)
## University
uniIVRegBw2 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw2==1))
uniIVRegBw4 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw4==1))
uniIVRegBw8 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw8==1))
regLogUni <- feols(educPropUni ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEduc)
optimalUniBw <- rdbwselect(regLogUni$residuals, sample7cutoffsEduc$margin_relative, p=2, fuzzy = sample7cutoffsEduc$treated, cluster = sample7cutoffsEduc$microrregion_id)
uniIVRegOptimal = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(marginAbs < optimalUniBw$bws[1]*closest_cutoff))
## High School
highSIVRegBw2 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw2==1))
highSIVRegBw4 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw4==1))
highSIVRegBw8 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw8==1))
regLogHighS <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEduc)
optimalHighSBw <- rdbwselect(regLogHighS$residuals, sample7cutoffsEduc$margin_relative, p=2, fuzzy = sample7cutoffsEduc$treated, cluster = sample7cutoffsEduc$microrregion_id)
highSIVRegOptimal = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(marginAbs < optimalHighSBw$bws[1]*closest_cutoff))
## RDPlots
pUni <- rdplot(regLogUni$residuals, sample7cutoffsEduc$margin, p=2, x.label="Normalized Population", y.label = "University Degree or Higher (%)", title="University Degree")
pHighS <- rdplot(regLogHighS$residuals, sample7cutoffsEduc$margin, p=2, x.label="Normalized Population", y.label = "High Schol Degree or Higher (%)", title="High School Degree")
pEducationRd <- ggarrange(pUni$rdplot + theme(plot.title = element_text(hjust = 0.5)), pHighS$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(pEducationRd, file=paste0(figureDir, "EducationRd.png"), width=12, height=4)
summary(temporaryIVRegBw2, cov = ~microrregion_id)
summary(temporaryIVRegBw4, cov = ~microrregion_id)
summary(temporaryIVRegBw2, cov = ~microrregion_id)
summary(temporaryIVRegBw2)
summary(temporaryIVRegBw2, cov =~microrregion_id)
summary(temporaryIVRegBw2, hcov =~microrregion_id)
summary(propIVRegOptimalsouth, vcov=~microrregion_id)
summary(highSIVRegOptimal, vcov=~microrregion_id)
summary(highSIVRegOptimalsouth, vcov=~microrregion_id)
## North
north <- sample7cutoffs %>% filter(region == 'Norte')
library(tidyverse)
library(this.path)
library(rdrobust)
library(fixest)
library(rddensity)
library(ggpubr)
setwd(this.dir())
dataDir <- "../1_data/"
figureDir <- "../3_figures/"
fullSample <- readRDS(paste0(dataDir,"fullSampleT.rds"))
fullSample <- fullSample %>% filter(year<=2022)
sample7cutoffs <- fullSample %>% filter(cutoffId %in% 1:7)
sample7cutoffs <- sample7cutoffs %>% mutate(marginAbs = abs(margin))
sample7cutoffs <- sample7cutoffs %>% mutate(bw4 = if_else(marginAbs < 0.04*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw8 = if_else(marginAbs < 0.08*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(bw2 = if_else(marginAbs < 0.02*closest_cutoff, 1,0))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpmlaw = log(fpmLaw))
sample7cutoffs <- sample7cutoffs %>% mutate(lfpm = log(transfer_value))
sample7cutoffs <- sample7cutoffs %>% mutate(prop = temporaries/total_employees)
sample7cutoffs <- sample7cutoffs %>% mutate(lemp = log(temporaries+1))
sample7cutoffs <- sample7cutoffs %>% mutate(margin_relative = margin/closest_cutoff)
sample7cutoffs <- sample7cutoffs %>% mutate(treated = if_else(
transfer_value>=fpmLaw, 1 , 0
))
# Methdology
# First, we need to run the regressions of our depedent variables on the FEs, then we use the residuals to do the RD Plots.
regLawFpm <- feols(lfpmlaw ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
regActualFpm <- feols(lfpm ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffs)
pLawFpm <- rdplot(regLawFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Law Implied FPM (Log)", title = "Law Implied FPM")
pActualFpm <- rdplot(regActualFpm$residuals, sample7cutoffs$margin, p=2, x.label="Normalized Population", y.label = "Actual FPM (Log)", title = "Actual FPM")
finalFPM <- ggarrange(pLawFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), pActualFpm$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFPM, file=paste0(figureDir, "FPMRdPlot.png"), width=12, height=4)
# Regressions - Methdology
fpmRegBw2 = feols(lfpm ~ lfpmlaw + marginAbs + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw2==1))
fpmRegBw4 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2  | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw4==1))
fpmRegBw8 = feols(lfpm ~ lfpmlaw + marginAbs  + marginAbs **2 | cutoffId^year + municipality_id + state^year, sample7cutoffs %>% filter(bw8==1))
# Other Revenues and Local Taxes
sample7cutoffs <- sample7cutoffs %>% mutate(other_revenue = total_revenue - transfer_value)
sample7cutoffsTax <- sample7cutoffs %>% filter(!is.na(other_revenue) & !is.na(local_taxes) & other_revenue>0)
regOtherRev <- feols(log(other_revenue+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
regLocalTaxes <- feols(log(local_taxes+1) ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTax)
pOtherRevenue <- rdplot(regOtherRev$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Other Revenues (Log)", title = "Other Revenues")
pLocalTaxes <- rdplot(regLocalTaxes$residuals, sample7cutoffsTax$margin, p=2, x.label="Normalized Population", y.label = "Local Taxes (Log)", title = "Local Taxes")
finalFinances<- ggarrange(pOtherRevenue$rdplot + theme(plot.title = element_text(hjust = 0.5)), pLocalTaxes$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(finalFinances, file=paste0(figureDir, "FinancesRdPlot.png"), width=12, height=4)
# Density Plots
sample2019 <- sample7cutoffs %>% filter(year == 2019)
d2019 <- rddensity(sample2019$margin)
dp2019 <- rdplotdensity(d2019, sample2019$margin)
sample2009 <- sample7cutoffs %>% filter(year == 2009)
d2009 <- rddensity(sample2009$margin)
dp2009 <- rdplotdensity(d2009, sample2009$margin)
sample2005 <- sample7cutoffs %>% filter(year == 2005)
d2005 <- rddensity(sample2005$margin)
dp2005 <- rdplotdensity(d2005, sample2005$margin)
sample1999 <- sample7cutoffs %>% filter(year == 1999)
d1999 <- rddensity(sample1999$margin)
dp1999 <- rdplotdensity(d1999, sample1999$margin)
finalDensity <- ggarrange(dp1999$Estplot + ggtitle("1999") + theme(plot.title = element_text(hjust = 0.5)),
dp2005$Estplot + ggtitle("2005") + theme(plot.title = element_text(hjust = 0.5)),
dp2009$Estplot + ggtitle("2009") + theme(plot.title = element_text(hjust = 0.5)),
dp2019$Estplot + ggtitle("2019") + theme(plot.title = element_text(hjust = 0.5)),
ncol = 2, nrow = 2)
ggsave(finalDensity, file=paste0(figureDir, "DensityPlots.png"), width=9, height=4)
## IV Regressions - Section 5.1
# Quantity of Emp.
temporaryIVRegBw2 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw2==1))
temporaryIVRegBw4 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw4==1))
temporaryIVRegBw8 = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw8==1))
sample7cutoffsTemp <- sample7cutoffs %>% filter(!is.na(lemp))
regLogTemps <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsTemp)
optimalTempBw <- rdbwselect(regLogTemps$residuals, sample7cutoffsTemp$margin_relative, p=2, fuzzy = sample7cutoffsTemp$treated, cluster = sample7cutoffsTemp$microrregion_id)
temporaryIVRegOptimal = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(marginAbs < optimalTempBw$bws[1]*closest_cutoff))
# Proportion
propIVRegBw2 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw2==1))
propIVRegBw4 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw4==1))
propIVRegBw8 = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(bw8==1))
sample7cutoffsProp <- sample7cutoffs %>% filter(!is.na(prop))
regLogProp <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsProp)
optimalPropBw <- rdbwselect(regLogProp$residuals, sample7cutoffsProp$margin_relative, p=2, fuzzy = sample7cutoffsProp$treated, cluster = sample7cutoffsProp$microrregion_id)
propIVRegOptimal = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffs %>% filter(marginAbs < optimalPropBw$bws[1]*closest_cutoff))
pLogTemps <- rdplot(regLogTemps$residuals, sample7cutoffsTemp$margin, p=2, x.label="Normalized Population", y.label = "Quantity of Temporary/Comissioned Employees (Log)", title="Temporary/Comissioned Employees")
pPropTemps <- rdplot(regLogProp$residuals, sample7cutoffsProp$margin, p=2, x.label="Normalized Population", y.label = "Proportion of Temporary/Comissioned Employees (%)", title="Proportion of Temporary/Comissioned Employees")
pTempsRd <- ggarrange(pLogTemps$rdplot + theme(plot.title = element_text(hjust = 0.5)), pPropTemps$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(pTempsRd, file=paste0(figureDir, "ProportionQuantityRd.png"), width=12, height=4)
# Wages
sample7cutoffsWages <- sample7cutoffs %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
sample7cutoffsWages <- sample7cutoffsWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
wageIVRegBw2 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw2==1))
wageIVRegBw4 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw4==1))
wageIVRegBw8 = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(bw8==1))
regLogWages <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsWages)
optimalWagesBw <- rdbwselect(regLogWages$residuals, sample7cutoffsWages$margin_relative, p=2, fuzzy = sample7cutoffsWages$treated, cluster = sample7cutoffsWages$microrregion_id)
wagesIVRegOptimal = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWages %>% filter(marginAbs < optimalWagesBw$bws[1]*closest_cutoff))
pWages <- rdplot(regLogWages$residuals, sample7cutoffsWages$margin, p=2, x.label="Normalized Population", y.label = "Avg Wage per Temporary/Commissioned Employee (Log)", title="")
ggsave(pWages$rdplot + theme(plot.title = element_text(hjust = 0.5)), file=paste0(figureDir, "WagesRD.png"), width=6, height=4)
# Education
sample7cutoffsEduc <- sample7cutoffs %>% filter(temporaries>0 & !is.na(temporaries))
sample7cutoffsEduc <- sample7cutoffsEduc %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
sample7cutoffsEduc <- sample7cutoffsEduc %>% mutate(educPropUni = (temporaries_university/temporaries)*100)
## University
uniIVRegBw2 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw2==1))
uniIVRegBw4 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw4==1))
uniIVRegBw8 = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw8==1))
regLogUni <- feols(educPropUni ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEduc)
optimalUniBw <- rdbwselect(regLogUni$residuals, sample7cutoffsEduc$margin_relative, p=2, fuzzy = sample7cutoffsEduc$treated, cluster = sample7cutoffsEduc$microrregion_id)
uniIVRegOptimal = feols(educPropUni ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(marginAbs < optimalUniBw$bws[1]*closest_cutoff))
## High School
highSIVRegBw2 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw2==1))
highSIVRegBw4 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw4==1))
highSIVRegBw8 = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(bw8==1))
regLogHighS <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEduc)
optimalHighSBw <- rdbwselect(regLogHighS$residuals, sample7cutoffsEduc$margin_relative, p=2, fuzzy = sample7cutoffsEduc$treated, cluster = sample7cutoffsEduc$microrregion_id)
highSIVRegOptimal = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEduc %>% filter(marginAbs < optimalHighSBw$bws[1]*closest_cutoff))
## RDPlots
pUni <- rdplot(regLogUni$residuals, sample7cutoffsEduc$margin, p=2, x.label="Normalized Population", y.label = "University Degree or Higher (%)", title="University Degree")
pHighS <- rdplot(regLogHighS$residuals, sample7cutoffsEduc$margin, p=2, x.label="Normalized Population", y.label = "High Schol Degree or Higher (%)", title="High School Degree")
pEducationRd <- ggarrange(pUni$rdplot + theme(plot.title = element_text(hjust = 0.5)), pHighS$rdplot + theme(plot.title = element_text(hjust = 0.5)), ncol = 2, nrow = 1)
ggsave(pEducationRd, file=paste0(figureDir, "EducationRd.png"), width=12, height=4)
# Electoral Competition
sample7cutoffsCompetitive <- sample7cutoffs %>% filter(competitividade == 1)
sample7cutoffsNotCompetitive <- sample7cutoffs %>% filter(competitividade == 0)
## Competitive
### Quantity - Temp
sample7cutoffsCompetitiveTemp <- sample7cutoffsCompetitive %>% filter(!is.na(lemp))
regLogTempsC <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsCompetitiveTemp)
optimalTempBwC <- rdbwselect(regLogTempsC$residuals, sample7cutoffsCompetitiveTemp$margin_relative, p=2, fuzzy = sample7cutoffsCompetitiveTemp$treated, cluster = sample7cutoffsCompetitiveTemp$microrregion_id)
temporaryIVRegOptimalC = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsCompetitiveTemp %>% filter(marginAbs < optimalTempBwC$bws[1]*closest_cutoff))
### Proportion - Temp
sample7cutoffsPropC <- sample7cutoffsCompetitive %>% filter(!is.na(prop))
regLogPropC <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsPropC)
optimalPropBwC <- rdbwselect(regLogPropC$residuals, sample7cutoffsPropC$margin_relative, p=2, fuzzy = sample7cutoffsPropC$treated, cluster = sample7cutoffsPropC$microrregion_id)
propIVRegOptimalC = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsPropC %>% filter(marginAbs < optimalPropBwC$bws[1]*closest_cutoff))
### Wages - Temp
sample7cutoffsWagesC <- sample7cutoffsCompetitive %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
sample7cutoffsWagesC <- sample7cutoffsWagesC %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagesC <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsWagesC)
optimalWagesBwC <- rdbwselect(regLogWagesC$residuals, sample7cutoffsWagesC$margin_relative, p=2, fuzzy = sample7cutoffsWagesC$treated, cluster = sample7cutoffsWagesC$microrregion_id)
wagesIVRegOptimalC = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWagesC %>% filter(marginAbs < optimalWagesBwC$bws[1]*closest_cutoff))
### Education - Temp
sample7cutoffsEducC <- sample7cutoffsCompetitive %>% filter(temporaries>0 & !is.na(temporaries))
sample7cutoffsEducC <- sample7cutoffsEducC %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighSC <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEducC)
optimalHighSBwC <- rdbwselect(regLogHighSC$residuals, sample7cutoffsEducC$margin_relative, p=2, fuzzy = sample7cutoffsEducC$treated, cluster = sample7cutoffsEducC$microrregion_id)
highSIVRegOptimalC = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEducC %>% filter(marginAbs < optimalHighSBwC$bws[1]*closest_cutoff))
## Not Competitive
sample7cutoffsNotCompetitiveTemp <- sample7cutoffsNotCompetitive %>% filter(!is.na(lemp))
regLogTempsNC <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsNotCompetitiveTemp)
optimalTempBwNC <- rdbwselect(regLogTempsNC$residuals, sample7cutoffsNotCompetitiveTemp$margin_relative, p=2, fuzzy = sample7cutoffsNotCompetitiveTemp$treated, cluster = sample7cutoffsNotCompetitiveTemp$microrregion_id)
temporaryIVRegOptimalNC = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsNotCompetitiveTemp %>% filter(marginAbs < optimalTempBwNC$bws[1]*closest_cutoff))
### Proportion - Temp
sample7cutoffsPropNC <- sample7cutoffsNotCompetitive %>% filter(!is.na(prop))
regLogPropNC <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsPropNC)
optimalPropBwNC <- rdbwselect(regLogPropNC$residuals, sample7cutoffsPropNC$margin_relative, p=2, fuzzy = sample7cutoffsPropNC$treated, cluster = sample7cutoffsPropNC$microrregion_id)
propIVRegOptimalNC = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsPropNC %>% filter(marginAbs < optimalPropBwNC$bws[1]*closest_cutoff))
### Wages - Temp
sample7cutoffsWagesNC <- sample7cutoffsNotCompetitive %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
sample7cutoffsWagesNC <- sample7cutoffsWagesNC %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagesNC <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsWagesNC)
optimalWagesBwNC <- rdbwselect(regLogWagesNC$residuals, sample7cutoffsWagesNC$margin_relative, p=2, fuzzy = sample7cutoffsWagesNC$treated, cluster = sample7cutoffsWagesNC$microrregion_id)
wagesIVRegOptimalNC = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsWagesNC %>% filter(marginAbs < optimalWagesBwNC$bws[1]*closest_cutoff))
### Education - Temp
sample7cutoffsEducNC <- sample7cutoffsNotCompetitive %>% filter(temporaries>0 & !is.na(temporaries))
sample7cutoffsEducNC <- sample7cutoffsEducNC %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighSNC <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, sample7cutoffsEducNC)
optimalHighSBwNC <- rdbwselect(regLogHighSNC$residuals, sample7cutoffsEducNC$margin_relative, p=2, fuzzy = sample7cutoffsEducNC$treated, cluster = sample7cutoffsEducNC$microrregion_id)
highSIVRegOptimalNC = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, sample7cutoffsEducNC %>% filter(marginAbs < optimalHighSBwC$bws[1]*closest_cutoff))
# Regional Analysis
state_to_region_map <- c(
'AC' = 'Norte',
'AL' = 'Nordeste',
'AP' = 'Norte',
'AM' = 'Norte',
'BA' = 'Nordeste',
'CE' = 'Nordeste',
'DF' = 'Centro-Oeste',
'ES' = 'Sudeste',
'GO' = 'Centro-Oeste',
'MA' = 'Nordeste',
'MT' = 'Centro-Oeste',
'MS' = 'Centro-Oeste',
'MG' = 'Sudeste',
'PA' = 'Norte',
'PB' = 'Nordeste',
'PR' = 'Sul',
'PE' = 'Nordeste',
'PI' = 'Nordeste',
'RJ' = 'Sudeste',
'RN' = 'Nordeste',
'RS' = 'Sul',
'RO' = 'Norte',
'RR' = 'Norte',
'SC' = 'Sul',
'SP' = 'Sudeste',
'SE' = 'Nordeste',
'TO' = 'Norte'
)
sample7cutoffs <- sample7cutoffs %>%
mutate(region = state_to_region_map[state])
## North
north <- sample7cutoffs %>% filter(region == 'Norte')
northTemp <- north %>% filter(!is.na(lemp))
regLogTempsNorth <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, northTemp)
optimalTempBwNorth <- rdbwselect(regLogTempsNorth$residuals, northTemp$margin_relative, p=2, fuzzy = northTemp$treated, cluster = northTemp$microrregion_id)
temporaryIVRegOptimalNorth = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northTemp %>% filter(marginAbs < optimalTempBwNorth$bws[1]*closest_cutoff))
### Proportion - Temp
northProp <- north %>% filter(!is.na(prop))
regLogPropNorth <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, northProp)
optimalPropBwNorth <- rdbwselect(regLogPropNorth$residuals, northProp$margin_relative, p=2, fuzzy = northProp$treated, cluster = northProp$microrregion_id)
propIVRegOptimalNorth = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northProp %>% filter(marginAbs < optimalPropBwNorth$bws[1]*closest_cutoff))
### Wages - Temp
northWages <- north %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
northWages <- northWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagesNorth <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, northWages)
optimalWagesBwNorth <- rdbwselect(regLogWagesNorth$residuals, northWages$margin_relative, p=2, fuzzy = northWages$treated, cluster = northWages$microrregion_id)
wagesIVRegOptimalNorth = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northWages %>% filter(marginAbs < optimalWagesBwNorth$bws[1]*closest_cutoff))
### Education - Temp
educNorth <- north %>% filter(temporaries>0 & !is.na(temporaries))
educNorth <- educNorth %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighNorth <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, educNorth)
optimalHighSBwNorth <- rdbwselect(regLogHighNorth$residuals, educNorth$margin_relative, p=2, fuzzy = educNorth$treated, cluster = educNorth$microrregion_id)
highSIVRegOptimalNorth = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, educNorth %>% filter(marginAbs < optimalHighSBwNorth$bws[1]*closest_cutoff))
## Northeast
northeast <- sample7cutoffs %>% filter(region == 'Nordeste')
northeastTemp <- northeast %>% filter(!is.na(lemp))
regLogTempsnortheast <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, northeastTemp)
optimalTempBwnortheast <- rdbwselect(regLogTempsnortheast$residuals, northeastTemp$margin_relative, p=2, fuzzy = northeastTemp$treated, cluster = northeastTemp$microrregion_id)
temporaryIVRegOptimalnortheast = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northeastTemp %>% filter(marginAbs < optimalTempBwnortheast$bws[1]*closest_cutoff))
### Proportion - Temp
northeastProp <- northeast %>% filter(!is.na(prop))
regLogPropnortheast <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, northeastProp)
optimalPropBwnortheast <- rdbwselect(regLogPropnortheast$residuals, northeastProp$margin_relative, p=2, fuzzy = northeastProp$treated, cluster = northeastProp$microrregion_id)
propIVRegOptimalnortheast = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northeastProp %>% filter(marginAbs < optimalPropBwnortheast$bws[1]*closest_cutoff))
### Wages - Temp
northeastWages <- northeast %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
northeastWages <- northeastWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagesnortheast <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, northeastWages)
optimalWagesBwnortheast <- rdbwselect(regLogWagesnortheast$residuals, northeastWages$margin_relative, p=2, fuzzy = northeastWages$treated, cluster = northeastWages$microrregion_id)
wagesIVRegOptimalnortheast = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, northeastWages %>% filter(marginAbs < optimalWagesBwnortheast$bws[1]*closest_cutoff))
### Education - Temp
educnortheast <- northeast %>% filter(temporaries>0 & !is.na(temporaries))
educnortheast <- educnortheast %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighnortheast <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, educnortheast)
optimalHighSBwnortheast <- rdbwselect(regLogHighnortheast$residuals, educnortheast$margin_relative, p=2, fuzzy = educnortheast$treated, cluster = educnortheast$microrregion_id)
highSIVRegOptimalnortheast = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, educnortheast %>% filter(marginAbs < optimalHighSBwnortheast$bws[1]*closest_cutoff))
## Central
central <- sample7cutoffs %>% filter(region == 'Centro-Oeste')
centralTemp <- central %>% filter(!is.na(lemp))
regLogTempscentral <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, centralTemp)
optimalTempBwcentral <- rdbwselect(regLogTempscentral$residuals, centralTemp$margin_relative, p=2, fuzzy = centralTemp$treated, cluster = centralTemp$microrregion_id)
temporaryIVRegOptimalcentral = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, centralTemp %>% filter(marginAbs < optimalTempBwcentral$bws[1]*closest_cutoff))
### Proportion - Temp
centralProp <- central %>% filter(!is.na(prop))
regLogPropcentral <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, centralProp)
optimalPropBwcentral <- rdbwselect(regLogPropcentral$residuals, centralProp$margin_relative, p=2, fuzzy = centralProp$treated, cluster = centralProp$microrregion_id)
propIVRegOptimalcentral = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, centralProp %>% filter(marginAbs < optimalPropBwcentral$bws[1]*closest_cutoff))
### Wages - Temp
centralWages <- central %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
centralWages <- centralWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagescentral <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, centralWages)
optimalWagesBwcentral <- rdbwselect(regLogWagescentral$residuals, centralWages$margin_relative, p=2, fuzzy = centralWages$treated, cluster = centralWages$microrregion_id)
wagesIVRegOptimalcentral = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, centralWages %>% filter(marginAbs < optimalWagesBwcentral$bws[1]*closest_cutoff))
### Education - Temp
educcentral <- central %>% filter(temporaries>0 & !is.na(temporaries))
educcentral <- educcentral %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighcentral <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, educcentral)
optimalHighSBwcentral <- rdbwselect(regLogHighcentral$residuals, educcentral$margin_relative, p=2, fuzzy = educcentral$treated, cluster = educcentral$microrregion_id)
highSIVRegOptimalcentral = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, educcentral %>% filter(marginAbs < optimalHighSBwcentral$bws[1]*closest_cutoff))
## Sudeste
southeast <- sample7cutoffs %>% filter(region == 'Sudeste')
southeastTemp <- southeast %>% filter(!is.na(lemp))
regLogTempssoutheast <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, southeastTemp)
optimalTempBwsoutheast <- rdbwselect(regLogTempssoutheast$residuals, southeastTemp$margin_relative, p=2, fuzzy = southeastTemp$treated, cluster = southeastTemp$microrregion_id)
temporaryIVRegOptimalsoutheast = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southeastTemp %>% filter(marginAbs < optimalTempBwsoutheast$bws[1]*closest_cutoff))
### Proportion - Temp
southeastProp <- southeast %>% filter(!is.na(prop))
regLogPropsoutheast <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, southeastProp)
optimalPropBwsoutheast <- rdbwselect(regLogPropsoutheast$residuals, southeastProp$margin_relative, p=2, fuzzy = southeastProp$treated, cluster = southeastProp$microrregion_id)
propIVRegOptimalsoutheast = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southeastProp %>% filter(marginAbs < optimalPropBwsoutheast$bws[1]*closest_cutoff))
### Wages - Temp
southeastWages <- southeast %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
southeastWages <- southeastWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagessoutheast <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, southeastWages)
optimalWagesBwsoutheast <- rdbwselect(regLogWagessoutheast$residuals, southeastWages$margin_relative, p=2, fuzzy = southeastWages$treated, cluster = southeastWages$microrregion_id)
wagesIVRegOptimalsoutheast = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southeastWages %>% filter(marginAbs < optimalWagesBwsoutheast$bws[1]*closest_cutoff))
### Education - Temp
educsoutheast <- southeast %>% filter(temporaries>0 & !is.na(temporaries))
educsoutheast <- educsoutheast %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighsoutheast <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, educsoutheast)
optimalHighSBwsoutheast <- rdbwselect(regLogHighsoutheast$residuals, educsoutheast$margin_relative, p=2, fuzzy = educsoutheast$treated, cluster = educsoutheast$microrregion_id)
highSIVRegOptimalsoutheast = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, educsoutheast %>% filter(marginAbs < optimalHighSBwsoutheast$bws[1]*closest_cutoff))
## South
south <- sample7cutoffs %>% filter(region == 'Sul')
southTemp <- south %>% filter(!is.na(lemp))
regLogTempssouth <- feols(lemp ~ 1 | cutoffId^year + municipality_id + state^year, southTemp)
optimalTempBwsouth <- rdbwselect(regLogTempssouth$residuals, southTemp$margin_relative, p=2, fuzzy = southTemp$treated, cluster = southTemp$microrregion_id)
temporaryIVRegOptimalsouth = feols(lemp ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southTemp %>% filter(marginAbs < optimalTempBwsouth$bws[1]*closest_cutoff))
### Proportion - Temp
southProp <- south %>% filter(!is.na(prop))
regLogPropsouth <- feols(prop*100 ~ 1 | cutoffId^year + municipality_id + state^year, southProp)
optimalPropBwsouth <- rdbwselect(regLogPropsouth$residuals, southProp$margin_relative, p=2, fuzzy = southProp$treated, cluster = southProp$microrregion_id)
propIVRegOptimalsouth = feols(prop*100 ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southProp %>% filter(marginAbs < optimalPropBwsouth$bws[1]*closest_cutoff))
### Wages - Temp
southWages <- south %>% filter(temporaries>0 & !is.na(total_wage_temporaries) & total_wage_temporaries>0)
southWages <- southWages %>% mutate(logpcwage = log(total_wage_temporaries/temporaries))
regLogWagessouth <- feols(logpcwage ~ 1 | cutoffId^year + municipality_id + state^year, southWages)
optimalWagesBwsouth <- rdbwselect(regLogWagessouth$residuals, southWages$margin_relative, p=2, fuzzy = southWages$treated, cluster = southWages$microrregion_id)
wagesIVRegOptimalsouth = feols(logpcwage ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, southWages %>% filter(marginAbs < optimalWagesBwsouth$bws[1]*closest_cutoff))
### Education - Temp
educsouth <- south %>% filter(temporaries>0 & !is.na(temporaries))
educsouth <- educsouth %>% mutate(educPropHighSchool = (temporaries_high_school/temporaries)*100)
regLogHighsouth <- feols(educPropHighSchool ~ 1 | cutoffId^year + municipality_id + state^year, educsouth)
optimalHighSBwsouth <- rdbwselect(regLogHighsouth$residuals, educsouth$margin_relative, p=2, fuzzy = educsouth$treated, cluster = educsouth$microrregion_id)
highSIVRegOptimalsouth = feols(educPropHighSchool ~ marginAbs + marginAbs**2 | cutoffId^year + municipality_id + state^year | lfpm ~ lfpmlaw, educsouth %>% filter(marginAbs < optimalHighSBwsouth$bws[1]*closest_cutoff))
summary(temporaryIVRegOptimalC, vcov=~microrregion_id)
summary(highSIVRegOptimalsouth, vcov=~microrregion_id)
summary(wagesIVRegOptimalsouth, vcov=~microrregion_id)
summary(propIVRegOptimalsouth, vcov=~microrregion_id)
summary(temporaryIVRegOptimalsouth, vcov=~microrregion_id)
summary(highSIVRegOptimalsoutheast, vcov=~microrregion_id)
summary(wagesIVRegOptimalsoutheast, vcov=~microrregion_id)
summary(propIVRegOptimalsoutheast, vcov=~microrregion_id)
summary(temporaryIVRegOptimalsoutheast, vcov=~microrregion_id)
summary(highSIVRegOptimalcentral, vcov=~microrregion_id)
summary(wagesIVRegOptimalcentral, vcov=~microrregion_id)
summary(propIVRegOptimalcentral, vcov=~microrregion_id)
summary(temporaryIVRegOptimalcentral, vcov=~microrregion_id)
summary(highSIVRegOptimalnortheast, vcov=~microrregion_id)
summary(wagesIVRegOptimalnortheast, vcov=~microrregion_id)
summary(propIVRegOptimalnortheast, vcov=~microrregion_id)
summary(temporaryIVRegOptimalnortheast, vcov=~microrregion_id)
summary(highSIVRegOptimalNorth, vcov=~microrregion_id)
summary(wagesIVRegOptimalNorth, vcov=~microrregion_id)
summary(propIVRegOptimalNorth, vcov=~microrregion_id)
summary(temporaryIVRegOptimalNorth, vcov=~microrregion_id)
summary(wagesIVRegOptimalsouth, vcov=~microrregion_id)
